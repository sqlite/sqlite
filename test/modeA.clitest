# 2025-11-12
#
# The author disclaims copyright to this source code.  In place of
# a legal notice, here is a blessing:
#
#    May you do good and not evil.
#    May you find forgiveness for yourself and forgive others.
#    May you share freely, never taking more than you give.
#
#***********************************************************************
#
# Test cases for the ".mode" command of the CLI.
# To run these tests:
#
#   ./sqlite3 <test/modeA.clitest
#
#
CREATE TABLE t1(a,b,c,d,e);
INSERT INTO t1 VALUES(1,2.5,'three',x'4444',NULL);
INSERT INTO t1 SELECT b,c,d,e,a FROM t1;
INSERT INTO t1 SELECT d,e,a,b,c FROM t1;
.mode box

.output memory
SELECT * FROM t1;
.output --verify END
╭─────┬───────┬───────┬───────┬───────╮
│  a  │   b   │   c   │   d   │   e   │
╞═════╪═══════╪═══════╪═══════╪═══════╡
│   1 │   2.5 │ three │ DD    │       │
│ 2.5 │ three │ DD    │       │     1 │
│ DD  │       │     1 │   2.5 │ three │
│     │     1 │   2.5 │ three │ DD    │
╰─────┴───────┴───────┴───────┴───────╯
END

.output memory
.mode --null xyz
SELECT * FROM t1;
.output --verify END
╭─────┬───────┬───────┬───────┬───────╮
│  a  │   b   │   c   │   d   │   e   │
╞═════╪═══════╪═══════╪═══════╪═══════╡
│   1 │   2.5 │ three │ DD    │ xyz   │
│ 2.5 │ three │ DD    │ xyz   │     1 │
│ DD  │ xyz   │     1 │   2.5 │ three │
│ xyz │     1 │   2.5 │ three │ DD    │
╰─────┴───────┴───────┴───────┴───────╯
END

# Default output mode is qbox --quote relaxed
#
.mode tty --wrap 10
CREATE TABLE t2(a,b,c,d);
INSERT INTO t2 VALUES(1,2.5,'three',x'4444');
INSERT INTO t2 VALUES('The quick fox jumps over the lazy brown dog',2,3,4);
INSERT INTO t2 VALUES('10','', -1.25,NULL);
INSERT INTO t2 VALUES('a,b,c','"Double-Quoted"','-1.25','NULL');
.output memory
SELECT * FROM t2;
.output --verify END
╭────────────┬────────────┬─────────┬─────────╮
│     a      │     b      │    c    │    d    │
╞════════════╪════════════╪═════════╪═════════╡
│          1 │        2.5 │ three   │ x'4444' │
├────────────┼────────────┼─────────┼─────────┤
│ The quick  │          2 │       3 │       4 │
│ fox jumps  │            │         │         │
│ over the   │            │         │         │
│ lazy brown │            │         │         │
│ dog        │            │         │         │
├────────────┼────────────┼─────────┼─────────┤
│ '10'       │            │   -1.25 │ NULL    │
├────────────┼────────────┼─────────┼─────────┤
│ a,b,c      │ "Double-   │ '-1.25' │ 'NULL'  │
│            │ Quoted"    │         │         │
╰────────────┴────────────┴─────────┴─────────╯
END
.output memory
.mode
.output --verify END
.mode qbox --limits on --quote relaxed --sw auto --textjsonb on
END
.output memory
.mode -v
.output --verify END
.mode qbox --align "" --border on --blob-quote auto --colsep "" --escape auto --limits on --null "NULL" --quote relaxed --rowsep "" --sw auto --tablename "" --textjsonb on --titles on --widths "" --wordwrap off --wrap 10
END
.output memory --error-prefix "Error:"
.mode foo
.output --verify END
Error: .mode foo
Error:       ^--- unknown mode
Error: Use ".help .mode" for more info
END

.output memory
.mode --null xyzzy -v
.output -glob ' --null "xyzzy"'
.output memory
.mode -null abcde -v
.output -glob ' --null "abcde"'

# Test cases for the ".explain off" command
.mode box -reset
.output memory
EXPLAIN SELECT * FROM t1;
.output --notglob *────* --keep
.output --notglob "* id │ parent │ notused │ detail *" --keep
.output --glob "*   Init  *"
.output memory
EXPLAIN QUERY PLAN SELECT * FROM t1;
.output --glob "*`--SCAN *"
.explain off
.output memory
EXPLAIN SELECT * FROM t1;
.output --glob *────*
.output memory
EXPLAIN QUERY PLAN SELECT * FROM t1;
.output --glob "* id │ parent │ notused │ detail *"
.explain auto

# Test cases for limit settings in the .mode command.
.output memory
.mode box --reset
.mode
.output --verify END
.mode box
END
.output memory
.mode --limits 5,300,20
.mode
.output --verify END
.mode box --limits on
END
.output memory
.mode --limits 5,300,19
.mode
.output --verify END
.mode box --limits 5,300,19
END
.output memory
.mode --limits 0,0,0
.mode -v
.output --verify END
.mode box --align "" --border on --blob-quote auto --colsep "" --escape auto --limits off --null "" --quote off --rowsep "" --sw 0 --tablename "" --textjsonb off --titles on --widths "" --wordwrap off
END

.output memory
.mode --linelimit 123
.mode
.output --verify END
.mode box --limits 123,0,0
END

.output memory
.mode --linelimit 0 -charlimit 123
.mode
.output --verify END
.mode box --limits 0,123,0
END

.output memory
.mode --charlimit 0 -titlelimit 123
.mode
.output --verify END
.mode box --limits 0,0,123
END

.output memory
.mode list
.mode
.output --verify END
.mode list
END

.output memory
.mode -limits 0,123,0
.mode
.output --verify END
.mode list --limits 0,123,0
END

.output memory
.mode -limits 123,0,0
.mode
.output --verify END
.mode list
END

# --titlelimit functionality
#
.output memory
.mode line --limits off --titlelimit 20
SELECT a AS 'abcdefghijklmnopqrstuvwxyz', b FROM t2 WHERE c=3;
.output --verify END
abcdefghijklmnopq...: The quick fox jumps over the lazy brown dog
                   b: 2
END
.output memory
.mode line --titlelimit 10
SELECT a AS 'abcdefghijklmnopqrstuvwxyz', b FROM t2 WHERE c=3;
.output --verify END
abcdefg...: The quick fox jumps over the lazy brown dog
         b: 2
END
.output memory
.mode line --titlelimit 2
SELECT a AS 'abcdefghijklmnopqrstuvwxyz', b FROM t2 WHERE c=3;
.output --verify END
ab: The quick fox jumps over the lazy brown dog
 b: 2
END
.output memory
.mode line --titlelimit 4
SELECT a AS 'abcd', b FROM t2 WHERE c=3;
.output --verify END
abcd: The quick fox jumps over the lazy brown dog
   b: 2
END
.output memory
.mode line --titlelimit 3
SELECT a AS 'abcd', b FROM t2 WHERE c=3;
.output --verify END
...: The quick fox jumps over the lazy brown dog
  b: 2
END
